<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
    <title>{{i18n "Title"}}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/app.css?v=20250820-9">
    <script src="/js/main.js?v=20250820-2" defer></script>
    <script src="/js/flights-carousel.js?v=20250820-1" defer></script>
    <script src="/js/chat.js" defer></script>
</head>
<body style="font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;">
    {{> common/navbar nav}}
    <main class="route-content">
        {{{body}}}
    </main>
    {{> common/footer}}

    <!-- Chat launcher -->
    <button id="ca-chat-launcher" aria-label="Open travel assistant chat">
        üí¨
    </button>
    <div id="ca-chat-panel" class="hidden" role="dialog" aria-label="‚ú® AI travel assistant" aria-modal="false">
        <header>
            <strong>‚ú® AI travel assistant</strong>
            <button class="close" aria-label="Close">√ó</button>
        </header>
        <div class="messages" id="ca-chat-messages" aria-live="polite"></div>
        <form id="ca-chat-form">
            <input id="ca-chat-input" type="text" placeholder="Ask about flights, destinations, tips‚Ä¶" autocomplete="off" />
            <button type="submit">Send</button>
        </form>
    </div>

    {{#if dbWarning}}
    <!-- Dev technical message (lower-left). Only shown when DB warning exists. -->
    <button id="ca-dev-launcher" aria-label="Open developer technical message">
        ‚ö†Ô∏è
    </button>
    <div id="ca-dev-panel" class="hidden" role="dialog" aria-label="Developer Technical Message" aria-modal="false">
        <header>
            <strong>‚ö†Ô∏è Technical error</strong>
            <button class="close" aria-label="Close">√ó</button>
        </header>
        <div class="messages" id="ca-dev-messages" aria-live="polite">
            <div class="msg assistant" style="text-align:left">
                <div style="font-weight:800;">{{dbWarning.headline}}</div>
                {{#if dbWarning.missingEnv}}
                <div style="margin-top:8px;">
                    Missing environment variables:
                    <ul style="margin:6px 0 0 16px; padding:0;">
                        {{#each dbWarning.missingEnv}}
                        <li><code>{{this}}</code></li>
                        {{/each}}
                    </ul>
                </div>
                {{/if}}
                {{#if dbWarning.error}}
                <pre style="margin-top:8px; white-space:pre-wrap; word-wrap:break-word; font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; background:#f8fafc; color:#0b1220; border:1px solid var(--ca-border); border-radius:8px; padding:8px;">
                    {{dbWarning.error}}
                </pre>
                {{/if}}
                {{#if dbWarning.note}}
                <div style="margin-top:8px; color: var(--ca-muted); white-space:normal;">{{dbWarning.note}}</div>
                {{/if}}
                {{#if dbWarning.lastCheckedAt}}
                <div class="meta" style="margin-top:8px;font-size:12px;color:var(--ca-muted);">Last checked: {{dbWarning.lastCheckedAt}}</div>
                {{/if}}
            </div>
        </div>
        <!-- No form: sending is disabled intentionally -->
    </div>
    {{/if}}
</body>
</html>
